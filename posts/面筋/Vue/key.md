# Vue key

`key` 这个特殊的 attribute 主要作为 Vue 的虚拟 DOM 算法提示，在比较新旧节点列表时用于识别 vnode。


在没有 key 的情况下，Vue 将使用一种最小化元素移动的算法，并尽可能地就地更新/复用相同类型的元素。如果传了 key，则将根据 key 的变化顺序来重新排列元素，并且将始终移除/销毁 key 已经不存在的元素。



当我们在使用`v-for`时，需要给单元加上`key`  

- 如果不用key，Vue会采用就地复用原则：最小化element的移动，并且会尝试尽最大程度在同适当的地方对相同类型的element，做patch或者reuse。
	- **元素顺序变化时保留 DOM 状态** → 输入框内容错乱、组件状态残留。
	- **元素增减时复用错误节点** → 视图和数据的映射不一致。
    
- 如果使用了key，Vue会根据keys的顺序记录element，曾经拥有了key的element如果不再出现的话，会被直接remove或者destoryed
	- 准确判断：
	- **新增或删除元素**
	- **移动元素位置**
	- **复用或销毁组件实例**

### 如何设置key值
- **同级元素必须唯一** → 同一父级下的同级节点的 `key` 不能重复。
- **避免随机的临时 key**（如 `:key="Math.random()"`）→ 破坏复用机制，引发性能问题。

1. **理想选择**：**稳定的唯一标识符**
    - 数据 ID: `item.id`
    - 业务主键: `item.uuid`、`item.orderNo`

### 设置key值一定能提高diff效率吗？

其实不然，文档中也明确表示

> 当 Vue.js 用 v-for 正在更新已渲染过的元素列表时，它默认用“就地复用”策略。如果数据项的顺序被改变，Vue 将不会移动 DOM 元素来匹配数据项的顺序， 而是简单复用此处每个元素，并且确保它在特定索引下显示已被渲染过的每个元素

这个默认的模式是高效的，但是只适用于不依赖子组件状态或临时 DOM 状态 (例如：表单输入值) 的列表渲染输出

建议尽可能在使用 `v-for` 时提供 `key`，除非遍历输出的 DOM 内容非常简单，或者是刻意依赖默认行为以获取性能上的提升